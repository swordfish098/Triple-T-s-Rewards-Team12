{% extends "base.html" %}

{% block title %}Driver Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Driver Dashboard for {{ current_user.USERNAME }}</h2>

    <div class="box" style="margin-bottom: 2rem; padding: 1.5rem; border: 1px solid #ddd; border-radius: 5px;">
        <h3>Your Total Points Balance</h3>
        {# Use the total_points variable passed from the backend #}
        <p style="font-size: 2rem; font-weight: bold;">{{ total_points if total_points is defined else 'N/A' }}</p>
        <p class="text-muted">This is the sum of points from all your sponsor organizations.</p>
    </div>

    {# Section for Sponsor Stores #}
    <div class="card mb-4">
        <div class="card-header">
            Your Sponsor Stores
        </div>
        <div class="card-body">
            {# Check for the 'associations' variable from the route #}
            {% if associations %}
                <p>Click on a sponsor to view their rewards store and your point balance with them.</p>
                <ul class="list-group">
                    {% for assoc in associations %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <a href="{{ url_for('driver_bp.truck_rewards_store', sponsor_id=assoc.sponsor_id) }}">
                                {# Use the association to get the sponsor and org name #}
                                {{ assoc.sponsor.organization.ORG_NAME }}
                            </a>
                            <span class="badge bg-primary rounded-pill">{{ assoc.points }} points</span>
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>You are not yet a member of any sponsor organizations.</p>
            {% endif %}
        </div>
    </div>

    {# Quick Actions Section with the button layout #}
    <div class="dashboard-links">
        <h3>Quick Actions</h3>
        <p><a href="{{ url_for('driver_bp.point_history') }}" class="btn btn-primary">View Point History</a></p>
        <p><a href="{{ url_for('driver_bp.addresses') }}" class="btn btn-primary">Manage Shipping Addresses</a></p>
        <p><a href="{{ url_for('driver_bp.apply_driver') }}" class="btn btn-primary">Apply to a New Sponsor</a></p>
        <p><a href="{{ url_for('auth.settings') }}" class="btn btn-primary">My Settings</a></p>
    </div>

</div>
{% endblock %}